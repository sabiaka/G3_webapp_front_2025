<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿç”£æ•°ç®¡ç†APIè¨­è¨ˆæ›¸ (ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ”¹å–„ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
        }

        .method-badge {
            font-size: 0.8rem;
            font-weight: 700;
            padding: 0.2em 0.6em;
            border-radius: 0.25rem;
            color: white;
            display: inline-block;
            width: 80px;
            text-align: center;
        }

        .get {
            background-color: #3b82f6;
        }

        .post {
            background-color: #22c55e;
        }

        .put {
            background-color: #f97316;
        }

        pre code.hljs {
            padding: 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }

        /* Copy button */
        .code-block-wrapper {
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 4px;
            right: 6px;
            background: rgba(51, 65, 85, .85);
            color: #f1f5f9;
            font-size: 12px;
            font-weight: 600;
            padding: 6px 12px 6px 10px;
            border-radius: 8px;
            cursor: pointer;
            line-height: 1;
            display: flex;
            align-items: center;
            gap: 6px;
            backdrop-filter: blur(2px);
            border: 1px solid rgba(255, 255, 255, .08);
            transition: transform .16s ease, box-shadow .22s ease, background-color .25s ease;
            box-shadow: 0 2px 6px -2px rgba(15, 23, 42, .35);
        }

        .copy-btn svg {
            width: 16px;
            height: 16px;
        }

        .copy-btn:hover {
            background: rgba(71, 85, 105, .92);
            transform: translateY(-2px);
            box-shadow: 0 6px 14px -4px rgba(15, 23, 42, .45);
        }

        .copy-btn:active {
            transform: translateY(0);
            box-shadow: 0 3px 8px -4px rgba(15, 23, 42, .4);
        }

        .copy-btn.copied {
            background: linear-gradient(135deg, #16a34a 0%, #15803d 70%);
        }

        .copy-btn.copied svg {
            animation: pop .4s ease;
        }

        @keyframes pop {
            0% {
                transform: scale(.6) rotate(-20deg);
            }

            60% {
                transform: scale(1.15);
            }

            100% {
                transform: scale(1);
            }
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-4">
                    <svg class="w-12 h-12 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    <h1 class="text-4xl font-bold text-slate-900">PLC,Jetsoné€šä¿¡API è¨­è¨ˆæ›¸()</h1>
                </div>
                <a href="../index.html"
                    class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">
                    â† ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
                </a>
            </div>
            <div class="mt-4 p-4 bg-indigo-100 border-l-4 border-indigo-500 text-indigo-700 rounded-r-lg">
                <p class="font-bold">å¯¾è±¡: Jetsonã‹ã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®é€ä¿¡</p>
                <p class="text-sm mt-1">ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€PLCã‚„ç”»åƒæ¤œæŸ»ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰ã®ä¿¡å·ã‚’DBã«æ ¼ç´ã™ã‚‹ãŸã‚ã®APIä»•æ§˜ã‚’å®šç¾©ã—ã¾ã™ã€‚</p>
            </div>
        </header>

        <div class="space-y-12">

            <!-- 1. æ©Ÿæ¢°ç³»DBè¨­è¨ˆ -->
                <section id="db-design">
                    <h2 class="text-2xl font-bold border-b-2 border-indigo-500 pb-2 mb-4">1. æ©Ÿæ¢°ç³»DBè¨­è¨ˆ</h2>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold mt-6 mb-2">machine_logsï¼ˆæ©Ÿæ¢°ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ï¼‰</h3>
                    <pre><code class="language-sql">CREATE TABLE machine_logs (
    log_id SERIAL PRIMARY KEY,                                           -- ãƒ­ã‚°ID
    machine_name VARCHAR(100) NOT NULL,                                  -- å¯¾è±¡æ©Ÿæ¢°NAME
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,                       -- ç™ºç”Ÿæ™‚åˆ»
    log_type VARCHAR(10) CHECK (log_type IN ('error','warning','info')), -- ç¨®åˆ¥
    title VARCHAR(100) NOT NULL,                                         -- ãƒ­ã‚°ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆã‚³ãƒ¼ãƒ‰ + æ¦‚è¦ï¼‰
    message TEXT,                                                        -- è©³ç´°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    
);</code></pre>
                    <div class="mt-2 text-sm text-slate-600">
                        <p>POST <code>/api/ingress/plc</code> ã§å—ã‘å–ã‚‹å„ç¨®ãƒ­ã‚°æƒ…å ±ã‚’ã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚</p>
                    </div>
                </div>
            </section>

            <!-- 2. ç”»åƒç³»DBè¨­è¨ˆ -->
                <section id="image-db-design">
                    <h2 class="text-2xl font-bold border-b-2 border-indigo-500 pb-2 mb-4">2. ç”»åƒç³»DBè¨­è¨ˆ</h2>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <p class="mb-4">ç”»åƒç³»ãƒ‡ãƒ¼ã‚¿ã¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ»ãƒ­ãƒƒãƒˆãƒ»ã‚«ãƒ¡ãƒ©ã‚·ãƒ§ãƒƒãƒˆã®3éšå±¤ã§ç®¡ç†ã—ã¾ã™ã€‚ä»¥ä¸‹ã¯ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ä¾‹ã§ã™ã€‚</p>

                    <h3 class="text-lg font-semibold mt-4 mb-2">inspection_sectionsï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³æ­£è¦åŒ–ï¼‰</h3>
                    <pre><code class="language-sql">CREATE TABLE inspection_sections (
    section_id SERIAL PRIMARY KEY,                       -- ã‚»ã‚¯ã‚·ãƒ§ãƒ³IDï¼ˆå†…éƒ¨é€£ç•ªï¼‰
    section_code VARCHAR(32) UNIQUE NOT NULL,            -- ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…éƒ¨ã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹: 'spring', 'alayer'ï¼‰
    section_name VARCHAR(64) NOT NULL                    -- ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºåï¼ˆä¾‹: 'ãƒãƒç•™ã‚', 'Aå±¤æ¤œæŸ»'ï¼‰
);</code></pre>

                    <h3 class="text-lg font-semibold mt-6 mb-2">inspection_lotsï¼ˆãƒ­ãƒƒãƒˆ/è£½å“IDï¼‰</h3>
                    <pre><code class="language-sql">CREATE TABLE inspection_lots (
    id BIGSERIAL PRIMARY KEY,                                       -- ãƒ­ãƒƒãƒˆå†…éƒ¨IDï¼ˆé€£ç•ªï¼‰
    lot_id VARCHAR(64) NOT NULL,                                    -- ãƒ­ãƒƒãƒˆIDï¼ˆè£½å“IDç­‰ã€ä¾‹: 'MAT-10001'ï¼‰
    section_code VARCHAR(32) NOT NULL,                              -- ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…éƒ¨ã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹: 'spring'ï¼‰
    captured_at TIMESTAMP WITH TIME ZONE NOT NULL,                  -- æ¤œæŸ»ä»£è¡¨æ™‚åˆ»ï¼ˆæœ€åˆ/æœ€å¾Œã®ã„ãšã‚Œã‹ï¼‰
    UNIQUE (lot_id)                                                 -- ãƒ­ãƒƒãƒˆIDã¯ä¸€æ„
);</code></pre>

                    <h3 class="text-lg font-semibold mt-6 mb-2">inspection_camera_shotsï¼ˆã‚«ãƒ¡ãƒ©ã‚·ãƒ§ãƒƒãƒˆï¼‰</h3>
                    <pre><code class="language-sql">CREATE TABLE inspection_camera_shots (
    id BIGSERIAL PRIMARY KEY,                                                   -- ã‚·ãƒ§ãƒƒãƒˆå†…éƒ¨IDï¼ˆé€£ç•ªï¼‰
    lot_id_ref BIGINT NOT NULL REFERENCES inspection_lots(id) ON DELETE CASCADE,-- ãƒ­ãƒƒãƒˆå‚ç…§ID
    camera_id VARCHAR(64) NOT NULL,                                             -- ã‚«ãƒ¡ãƒ©IDï¼ˆä¾‹: 'B-spring01', 'A-main01'ï¼‰
    status VARCHAR(16) NOT NULL CHECK (status IN ('PASS','FAIL','MISSING')),    -- åˆ¤å®šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
    details TEXT NULL,                                                          -- ä¸è‰¯ç†ç”±ç­‰ï¼ˆPASSæ™‚ã¯NULLæ¨å¥¨ï¼‰
    image_path TEXT NULL,                                                       -- ç”»åƒãƒ‘ã‚¹ï¼ˆMISSINGæ™‚ã¯NULLå¯ï¼‰
    shot_seq INT NOT NULL DEFAULT 1,                                            -- åŒä¸€ã‚«ãƒ¡ãƒ©å†…ã®é€šç•ªï¼ˆ1..nï¼‰
    captured_at TIMESTAMP WITH TIME ZONE NULL                                   -- ã‚·ãƒ§ãƒƒãƒˆæ’®å½±æ™‚åˆ»
);</code></pre>

                    <h3 class="text-lg font-semibold mt-6 mb-2">ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä¾‹</h3>
                    <pre><code class="language-sql">CREATE INDEX idx_lots_section_date ON inspection_lots (section_code, date(captured_at) DESC, captured_at DESC); -- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‹æ—¥ä»˜æ¤œç´¢ç”¨
CREATE INDEX idx_shots_lot ON inspection_camera_shots (lot_id_ref);                                             -- ãƒ­ãƒƒãƒˆå˜ä½æ¤œç´¢ç”¨
CREATE INDEX idx_shots_camera ON inspection_camera_shots (camera_id);                                           -- ã‚«ãƒ¡ãƒ©å˜ä½æ¤œç´¢ç”¨
</code></pre>
                </div>
            </section>

            <!-- 3. PLCæƒ…å ±é€ä¿¡ -->
                <section id="post-plc-data">
                    <h2 class="text-2xl font-bold border-b-2 border-indigo-500 pb-2 mb-4">3. PLCãƒ­ã‚°æƒ…å ±é€ä¿¡ (PLCé€šä¿¡JETSON â†’ ã‚µãƒ¼ãƒãƒ¼)</h2>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex items-center space-x-4 mb-4">
                        <span class="method-badge post">POST</span>
                        <span class="font-mono text-lg font-semibold">/api/ingress/plc</span>
                        <span class="bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-bold">å„ªå…ˆåº¦: A</span>
                    </div>
                    <p class="mb-4">ç”Ÿç”£æ©Ÿæ¢° (PLC)
                        ã‹ã‚‰ã®æ§˜ã€…ãªæƒ…å ±ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã™ã‚‹ãŸã‚ã®æ±ç”¨APIã§ã™ã€‚ã‚¨ãƒ©ãƒ¼ã€èµ·å‹•é€šçŸ¥ã€æ¶ˆè€—å“ï¼ˆãƒ›ãƒƒã‚¯ãƒªãƒ³ã‚°ãªã©ï¼‰ã®æ®‹é‡è­¦å‘Šãªã©ã€ã‚ã‚‰ã‚†ã‚‹ç¨®é¡ã®ãƒ­ã‚°ã‚’ã“ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§å—ã‘ä»˜ã‘ã¾ã™ã€‚</p>
                    <h3 class="text-lg font-semibold mt-6 mb-2">ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£</h3>
                    <p class="text-sm mb-2">é€ä¿¡ã™ã‚‹æƒ…å ±ã®ç¨®é¡ã«å¿œã˜ã¦ <code>log_type</code> ã‚’ä½¿ã„åˆ†ã‘ã¾ã™ã€‚ï¼ˆä¾‹: <code>info</code>,
                        <code>warning</code>, <code>error</code>ï¼‰</p>
                    <pre><code class="language-json">{
    "timestamp": "2025-07-15T10:15:32Z",
    "machine_name":"åŠè‡ªå‹•ãƒãƒã©ã‚æ©Ÿ",
    "log_type": "error",
    "title": "E-102: ãƒˆãƒ«ã‚¯éè² è·",
    "message": "ãƒ¢ãƒ¼ã‚¿ãƒ¼ã®è² è·ãŒè¦å®šå€¤ã‚’è¶…ãˆã¾ã—ãŸã€‚"
}</code></pre>
                    <h3 class="text-lg font-semibold mt-6 mb-2">æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ (202 Accepted)</h3>
                    <p class="text-sm">ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã£ãŸã‚‰ã€ã‚µãƒ¼ãƒãƒ¼ã¯ã™ãã«ã€ŒOKï¼ã€ã¨è¿”äº‹ã‚’ã—ã¦ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã—ã¾ã™ã€‚ãã®ãŸã‚ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¯
                        <code>202 Accepted</code> ãŒæœ€é©ã§ã™ã€‚</p>
                    <pre><code class="language-json">{
    "message": "ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™ã€‚"
}</code></pre>
                </div>
            </section>

            <!-- 4. æ©Ÿæ¢°ã®ç¨¼åƒé–‹å§‹ -->
                <section id="start-machine">
                    <h2 class="text-2xl font-bold border-b-2 border-indigo-500 pb-2 mb-4">4. æ©Ÿæ¢°ã®ç¨¼åƒé–‹å§‹</h2>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex items-center space-x-4 mb-4">
                        <span class="method-badge post">POST</span>
                        <span class="font-mono text-lg font-semibold">/api/machines/{id}/start</span>
                        <span class="bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-bold">å„ªå…ˆåº¦: B</span>
                    </div>
                    <p class="mb-4">æ©Ÿæ¢°ã®ç¨¼åƒã‚’é–‹å§‹ã—ãŸã¨ãã«å‘¼ã¶APIã€‚é–‹å§‹æ™‚åˆ»ã‚’è¨˜éŒ²ã™ã‚‹ã®ã«ä½¿ã†</p>

                    <h3 class="text-lg font-semibold mt-6 mb-2">æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ (200 OK)</h3>
                    <pre><code class="language-json">{
    "started_at": "2025-07-15T08:00:00Z"
}</code></pre>

                    <h3 class="text-lg font-semibold mt-6 mb-2">ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ (404 Not Found)</h3>
                    <pre><code class="language-json">{
    "error": "Machine not found"
}</code></pre>
                </div>
            </section>

            <!-- 5. ç”Ÿç”£æ•°ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ -->
                <section id="increment-production">
                    <h2 class="text-2xl font-bold border-b-2 border-indigo-500 pb-2 mb-4">5. ç”Ÿç”£æ•°ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ</h2>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex items-center space-x-4 mb-4">
                        <span class="method-badge post">POST</span>
                        <span class="font-mono text-lg font-semibold">/api/machines/{id}/increment-production</span>
                        <span class="bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-bold">å„ªå…ˆåº¦: A</span>
                    </div>
                    <p class="mb-4">è£½å“ãŒ1å€‹å®Œæˆã™ã‚‹ãŸã³ã«ã€ã“ã®APIã‚’å©ã„ã¦ç´¯è¨ˆç”Ÿç”£æ•°ã‚’ãƒ—ãƒ©ã‚¹1ã™ã‚‹ã€‚</p>

                    <h3 class="text-lg font-semibold mt-6 mb-2">æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ (200 OK)</h3>
                    <pre><code class="language-json">{
    "today_production_count": 1521
}</code></pre>

                    <h3 class="text-lg font-semibold mt-6 mb-2">ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ (404 Not Found)</h3>
                    <pre><code class="language-json">{
    "error": "Machine not found"
}</code></pre>
                </div>
            </section>

            <!-- 6. æ–°ã—ã„ç”»åƒæ¤œæŸ»ãƒ‡ãƒ¼ã‚¿é€ä¿¡API -->
            <section id="post-inspection-data-new">
                <h2 class="text-2xl font-bold border-b-2 border-indigo-500 pb-2 mb-4">6. æ¤œæŸ»ãƒ‡ãƒ¼ã‚¿ä¸€æ‹¬ç™»éŒ² (Jetson â†’ ã‚µãƒ¼ãƒãƒ¼)</h2>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex items-center space-x-4 mb-4">
                        <span class="method-badge post">POST</span>
                        <span class="font-mono text-lg font-semibold">/api/ingress/inspection</span>
                        <span class="bg-teal-500 text-white px-3 py-1 rounded-full text-sm font-bold">è¶…é‡è¦ï¼</span>
                    </div>
                    <p class="mb-4">
                        Jetsonã‹ã‚‰æ¤œæŸ»çµæœã®ãƒ‡ãƒ¼ã‚¿ä¸€å¼ã‚’ã¾ã¨ã‚ã¦ãƒ‰ãƒ³ï¼ã¨é€ã‚‹ãŸã‚ã®APIã ã‚ˆã€‚<br>
                        å‰ã¯ <code>product_id</code> ã‚’ã“ã£ã¡ã§æ±ºã‚ã¦ãŸã‘ã©ã€ã“ã‚Œã‹ã‚‰ã¯<strong class="text-pink-500">ã‚µãƒ¼ãƒãƒ¼ãŒã‚¤ã‚±ã¦ã‚‹ <code>lot_id</code> ã‚’è‡ªå‹•ã§ã¤ã‘ã¦ãã‚Œã‚‹</strong>ã‹ã‚‰ã€ãƒã‚¸æ¥½ã¡ã‚“ã«ãªã£ãŸã‚“ã ã‚ˆã­âœ¨
                    </p>

                    <h3 class="text-lg font-semibold mt-6 mb-2">lot_idã®ãƒ«ãƒ¼ãƒ«ã«ã¤ã„ã¦</h3>
                    <div class="p-4 bg-indigo-100 border-l-4 border-indigo-500 text-indigo-700 rounded-r-lg mb-4">
                        <p class="font-bold">ã“ã“ãƒã‚¸å¤§äº‹ï¼</p>
                        <p class="text-sm mt-1">ã‚µãƒ¼ãƒãƒ¼ã¯ <code>metadata</code> ã«å…¥ã£ã¦ã‚‹ <code>section_code</code> ã‚’è¦‹ã¦ã€ã©ã£ã¡ã®IDã‚’ã¤ã‘ã‚‹ã‹åˆ¤æ–­ã™ã‚‹ã‚ˆã‚“ğŸ’–</p>
                        <ul class="list-disc list-inside mt-2 text-sm font-mono">
                            <li><code>section_code</code> ãŒ <strong>"ãƒãƒç•™ã‚"</strong> ã®å ´åˆ â†’ <code>MAT-00001</code>, <code>MAT-00002</code>, ...</li>
                            <li><code>section_code</code> ãŒ <strong>"Aå±¤æ¤œæŸ»"</strong> ã®å ´åˆ â†’ <code>LOLL-00001</code>, <code>LOLL-00002</code>, ...</li>
                        </ul>
                    </div>

                    <h3 class="text-lg font-semibold mt-6 mb-2">ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ãƒ«ãƒ¼ãƒ«</h3>
                    <div class="p-4 bg-green-100 border-l-4 border-green-500 text-green-700 rounded-r-lg mb-4">
                        <p class="font-bold">ãƒ•ã‚¡ã‚¤ãƒ«åã¯ã‚µãƒ¼ãƒãƒ¼ãŒè‡ªå‹•ã§ã¤ã‘ã¡ã‚ƒã†ï¼</p>
                        <p class="text-sm mt-1">Jetsonã‹ã‚‰é€ã‚‰ã‚Œã¦ããŸç”»åƒã¯ã€ã‚µãƒ¼ãƒãƒ¼å´ã§ãƒ«ãƒ¼ãƒ«ã«æ²¿ã£ãŸåå‰ã«ãƒªãƒãƒ¼ãƒ ã—ã¦ä¿å­˜ã™ã‚‹ã‚ˆã€‚ãƒ•ã‚¡ã‚¤ãƒ«åã§ã©ã®è£½å“ã®ã©ã®ã‚«ãƒ¡ãƒ©ã®å†™çœŸã‹ä¸€ç™ºã§ã‚ã‹ã‚‹ã‚ˆã†ã«ãªã£ã¦ã¦ã€ãƒã‚¸ä¾¿åˆ©âœ¨</p>
                        <p class="text-sm mt-2 font-mono bg-green-200 p-2 rounded">
                            <strong>ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:</strong> {lot_id}_{camera_id}_{shot_seq}.jpg<br>
                            <strong>ä¿å­˜ä¾‹:</strong> /imageDB/MAT-00123_B-spring01_1.jpg
                        </p>
                        <p class="text-xs mt-2">ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ãŒã€DBã®`inspection_camera_shots`ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚ã‚‹`image_path`ã‚«ãƒ©ãƒ ã«ä¿å­˜ã•ã‚Œã‚‹ã£ã¦ã‚ã‘ï¼</p>
                    </div>
                    
                    <h3 class="text-lg font-semibold mt-6 mb-2">ãƒªã‚¯ã‚¨ã‚¹ãƒˆå½¢å¼</h3>
                    <p class="text-sm mb-2"><code>multipart/form-data</code> ã§ã€JSONãƒ‡ãƒ¼ã‚¿ã¨ç”»åƒã‚’ä¸€ç·’ã«é€ã£ã¦ã­ï¼</p>
                    <ul class="list-disc list-inside text-sm space-y-1 mb-4">
                        <li>ãƒ‘ãƒ¼ãƒˆ1: <code>metadata</code> ã¨ã„ã†ã‚­ãƒ¼ã§ã€æ¤œæŸ»æƒ…å ±ã®JSONã‚’é€ã‚‹ã€‚</li>
                        <li>ãƒ‘ãƒ¼ãƒˆ2ä»¥é™: <code>metadata</code>å†…ã®<code>shots</code>é…åˆ—ã«å…¥ã£ã¦ã‚‹å„<code>camera_id</code>ã‚’ã‚­ãƒ¼ã«ã—ã¦ã€å¯¾å¿œã™ã‚‹ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é€ã‚‹ã€‚</li>
                    </ul>

                    <h3 class="text-lg font-semibold mt-6 mb-2"><code>metadata</code> ãƒ‘ãƒ¼ãƒˆã®JSONä¾‹</h3>
                    <p class="text-sm mb-2">1è£½å“ï¼ˆ1ãƒ­ãƒƒãƒˆï¼‰ã«é–¢ã™ã‚‹å…¨ã‚«ãƒ¡ãƒ©ã‚·ãƒ§ãƒƒãƒˆã®æƒ…å ±ã‚’ã€<code>shots</code>é…åˆ—ã«ã¾ã¨ã‚ã¦å…¥ã‚Œã¦ã­ï¼</p>
                    <div class="code-block-wrapper">
                    <pre><code class="language-json">{
    "section_code": "spring",
    "captured_at": "2025-09-12T05:09:04Z",
    "shots": [
        {
            "camera_id": "B-spring01",
            "status": "PASS",
            "details": null,
            "shot_seq": 1,
            "captured_at": "2025-09-12T05:09:02Z"
        },
        {
            "camera_id": "B-spring02",
            "status": "FAIL",
            "details": "å‚·ã‚ã‚Š",
            "shot_seq": 1,
            "captured_at": "2025-09-12T05:09:04Z"
        },
        {
            "camera_id": "B-spring03",
            "status": "MISSING",
            "details": "ç”»åƒãªã—",
            "shot_seq": 1,
            "captured_at": null
        }
    ]
}</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold mt-6 mb-2">Pythonã§ã®é€ä¿¡ã‚³ãƒ¼ãƒ‰ä¾‹</h3>
                    <p class="mb-2 text-sm"><code>files</code> ã‚’ä½œã‚‹æ™‚ã€ç”»åƒã®ã‚­ãƒ¼ã‚’ã¡ã‚ƒã‚“ã¨ <code>camera_id</code> ã«åˆã‚ã›ã‚‹ã®ãŒãƒã‚¤ãƒ³ãƒˆã ã‚ˆï¼</p>
                    <div class="code-block-wrapper">
                        <pre><code class="language-python">
import requests
import json
import datetime

url = "http://your-server.com/api/ingress/inspection"

# é€ä¿¡ã™ã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
metadata = {
  "section_code": "spring", # "ãƒãƒç•™ã‚" or "Aå±¤æ¤œæŸ»" ã«å¯¾å¿œã™ã‚‹ã‚³ãƒ¼ãƒ‰
  "captured_at": datetime.datetime.now(datetime.timezone.utc).isoformat(),
  "shots": [
    {
      "camera_id": "B-spring01",
      "status": "PASS",
      "details": None,
      "shot_seq": 1,
      "captured_at": "2025-09-12T05:09:02Z"
    },
    {
      "camera_id": "B-spring02",
      "status": "FAIL",
      "details": "å‚·ã‚ã‚Š",
      "shot_seq": 1,
      "captured_at": "2025-09-12T05:09:04Z"
    }
  ]
}

# é€ä¿¡ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ä¸€å¼ã‚’æº–å‚™
# (æ³¨æ„: 'MISSING'ã®ç”»åƒã¯å«ã‚ãªã„)
files = {
    'metadata': (None, json.dumps(metadata), 'application/json'),
    # metadataã®camera_idã‚’ã‚­ãƒ¼ã«ã—ã¦ç”»åƒã‚’ã‚»ãƒƒãƒˆï¼
    'B-spring01': ('B-spring01.jpg', open('/path/to/B-spring01.jpg', 'rb'), 'image/jpeg'),
    'B-spring02': ('B-spring02.jpg', open('/path/to/B-spring02.jpg', 'rb'), 'image/jpeg')
}

response = requests.post(url, files=files)

print(f"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰: {response.status_code}")
print("ãƒ¬ã‚¹ãƒãƒ³ã‚¹:", response.json())
</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold mt-6 mb-2">æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ (201 Created)</h3>
                    <p class="text-sm">ãƒ‡ãƒ¼ã‚¿ã¨ç”»åƒã‚’ã¡ã‚ƒã‚“ã¨å—ã‘å–ã£ã¦ã€æ–°ã—ã„ãƒ­ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ãŒä½œã‚ŒãŸã‚‰ã€ã‚µãƒ¼ãƒãƒ¼ã¯ã“ã‚“ãªæ„Ÿã˜â†‘â†‘ã§è¿”äº‹ã™ã‚‹ã‚ˆï¼<br>è¿”ã£ã¦ããŸ <code>lot_id</code> ã¯ã€ã‚ã¨ã§æ¤œç´¢ã¨ã‹ã™ã‚‹ã¨ãã«ä½¿ãˆã‚‹ã‹ã‚‰ã€è¶…ä¾¿åˆ©ï¼</p>
                    <pre><code class="language-json">{
    "message": "æ¤œæŸ»ãƒ‡ãƒ¼ã‚¿ã€ã†ã‡ãƒ¼ã„ï¼ä½œæˆOKã ã‚ˆğŸ‰",
    "lot_id": "MAT-00123"
}</code></pre>

                    <h3 class="text-lg font-semibold mt-6 mb-2">ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ (400 Bad Request)</h3>
                    <p class="text-sm">é€ã£ãŸãƒ‡ãƒ¼ã‚¿ãŒã‚¤ã‚±ã¦ãªã„ã¨ã€ã‚µãƒ¼ãƒãƒ¼ã¯æ€’ã£ã¦ã“ã†è¿”ã™ã‹ã‚‰ã€æ°—ã‚’ã¤ã‘ã¦ï¼</p>
                     <pre><code class="language-json">{
    "error": "ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒä¸æ­£ã§ã™ã€‚",
    "details": [
        "section_code ã¯å¿…é ˆé …ç›®ã§ã™ã€‚",
        "ç”»åƒãƒ•ã‚¡ã‚¤ãƒ« 'B-spring01.jpg' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚"
    ]
}</code></pre>
                </div>
            </section>

            <!-- 7. ç”»åƒã®ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³• -->
                <section id="get-image-direct">
                    <h2 class="text-2xl font-bold border-b-2 border-indigo-500 pb-2 mb-4">7. ç”»åƒã®ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³• (è¶…ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆ)</h2>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex items-center space-x-4 mb-4">
                        <span class="method-badge get">GET</span>
                        <span class="font-mono text-lg font-semibold">/imageDB/{product_id}.jpg</span>
                    </div>
                    <p class="mb-4">
                        Node.jsã®Expressã¨ã‹ã§<code>public</code>ãƒ•ã‚©ãƒ«ãƒ€ã‚’å…¬é–‹è¨­å®šã«ã—ã¨ã‘ã°ã€URLã‚’ç›´ã§å©ãã ã‘ã§ç”»åƒãŒè¦‹ã‚Œã¡ã‚ƒã†ã€‚ãƒã‚¸åã§æ¥½ã¡ã‚“ï¼
                    </p>
                    <h3 class="text-lg font-semibold mt-6 mb-2">ã‚¢ã‚¯ã‚»ã‚¹URLã®ä¾‹</h3>
                    <pre><code class="language-plaintext">http://your-server.com/imageDB/A-102-002.jpg</code></pre>
                </div>
            </section>

                        <!-- 8. æœªæ¤œæŸ»ãƒ­ãƒƒãƒˆIDã¨ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®å–å¾—ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ãƒ»æœ€å°ï¼‰ -->
                        <section id="get-uninspected-lot-ids">
                            <h2 class="text-2xl font-bold border-b-2 border-indigo-500 pb-2 mb-4">8. æœªæ¤œæŸ»ãƒ­ãƒƒãƒˆIDã¨ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®å–å¾—ï¼ˆJetsonç”¨ï¼å‰¯ä½œç”¨ãªã—ï¼‰</h2>
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <div class="flex items-center space-x-4 mb-4">
                                    <span class="method-badge get">GET</span>
                                    <span class="font-mono text-lg font-semibold">/api/ingress/inspection/uninspected-lot-ids</span>
                                    <span class="bg-sky-500 text-white px-3 py-1 rounded-full text-sm font-bold">æœ€å°ä»•æ§˜ï¼ˆID + ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼‰</span>
                                </div>

                                <p class="mb-4">Jetson ã« <strong>æœªæ¤œæŸ»ã® lot_id ã¨ã€ãã®ãƒ­ãƒƒãƒˆã«ç´ã¥ãç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹</strong> ã‚’è¿”ã—ã¾ã™ã€‚èª­ã¿å–ã‚Šå°‚ç”¨ã§ã€äºˆç´„ãƒ»ãƒ­ãƒƒã‚¯ãƒ»çŠ¶æ…‹å¤‰æ›´ãªã©ã®å‰¯ä½œç”¨ã¯ä¸€åˆ‡ã‚ã‚Šã¾ã›ã‚“ã€‚</p>

                                <h3 class="text-lg font-semibold mt-6 mb-2">ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆsection ã¯å¿…é ˆï¼‰</h3>
                                <table class="w-full text-left border-collapse">
                                    <thead>
                                        <tr>
                                            <th class="border-b-2 p-2">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</th>
                                            <th class="border-b-2 p-2">èª¬æ˜</th>
                                            <th class="border-b-2 p-2">ä¾‹</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="border-b p-2 font-mono">sectionï¼ˆå¿…é ˆï¼‰</td>
                                            <td class="border-b p-2">æ¤œæŸ»ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå†…éƒ¨ã‚³ãƒ¼ãƒ‰ï¼‰ã€‚ä¾‹: <code>spring</code>ï¼ˆãƒãƒç•™ã‚ï¼‰, <code>alayer</code>ï¼ˆAå±¤ï¼‰ã€‚</td>
                                            <td class="border-b p-2 font-mono">?section=spring</td>
                                        </tr>
                                    </tbody>
                                </table>

                                <h3 class="text-lg font-semibold mt-6 mb-2">ãƒ¬ã‚¹ãƒãƒ³ã‚¹</h3>
                                <p class="text-sm mb-2">200 OKï¼ˆæœ€å°æ§‹æˆï¼‰ â€” å„ãƒ­ãƒƒãƒˆã”ã¨ã« <code>lot_id</code> ã¨ãã®ãƒ­ãƒƒãƒˆã«ç´ã¥ãç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹é…åˆ—ã‚’è¿”ã—ã¾ã™ã€‚</p>
                                <pre><code class="language-json">{
    "lots": [
    {
        "lot_id": "MAT-00123",
        "image_paths": [
        "/imageDB/MAT-00123_B-spring01_1.jpg",
        "/imageDB/MAT-00123_B-spring02_1.jpg"
        ]
    },
    {
        "lot_id": "MAT-00124",
        "image_paths": [
        "/imageDB/MAT-00124_B-spring01_1.jpg"
        ]
    }
    ]
}</code></pre>

                                <p class="text-sm mt-4 mb-1">400 Bad Requestï¼ˆ<code>section</code> ãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆï¼‰</p>
                                <pre><code class="language-json">{
    "error": "Bad Request",
    "details": [
    "ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ 'section' ã¯å¿…é ˆã§ã™ã€‚"
    ]
}</code></pre>

                                <h3 class="text-lg font-semibold mt-6 mb-2">è¿”å´ãƒãƒªã‚·ãƒ¼</h3>
                                <ul class="list-disc list-inside text-sm space-y-1">
                                    <li>èª­ã¿å–ã‚Šå°‚ç”¨ã€‚ã‚µãƒ¼ãƒãƒ¼å´ã§äºˆç´„ãƒ»ãƒ­ãƒƒã‚¯ãƒ»çŠ¶æ…‹å¤‰æ›´ã¯è¡Œã„ã¾ã›ã‚“ã€‚</li>
                                    <li>è¿”å´ã•ã‚Œã‚‹æƒ…å ±ã¯ã‚µãƒ¼ãƒãƒ¼ãŒæŠŠæ¡ã™ã‚‹ã€Œæœªæ¤œæŸ»ã€çŠ¶æ…‹ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã§ã™ï¼ˆID ã¨ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼‰ã€‚</li>
                                    <li>å„ã‚¨ãƒ³ãƒˆãƒªã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã§ã€<code>lot_id</code> ã¨ <code>image_paths</code>ï¼ˆé…åˆ—ï¼‰ã‚’å«ã¿ã¾ã™ã€‚ç”»åƒãŒãªã„å ´åˆã¯ç©ºé…åˆ—ã«ãªã‚Šã¾ã™ã€‚</li>
                                    <li>ä¸¦ã³é †ã¯ä½œæˆæ—¥æ™‚ã®æ˜‡é †ï¼ˆå¤ã„æœªæ¤œæŸ»ã‹ã‚‰ï¼‰ã€‚</li>
                                    <li>è¿”å´ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã¯ã‚µãƒ¼ãƒãƒ¼ã®å…¬é–‹ãƒ‘ã‚¹ï¼ˆç›¸å¯¾ãƒ‘ã‚¹ã¾ãŸã¯çµ¶å¯¾URLï¼‰ã€‚Jetson å´ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å ´åˆã€<code>NEXT_PUBLIC_BASE_PATH</code> ç›¸å½“ã®æ¥é ­è¾ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™ â€” é…ç½®ç’°å¢ƒã«åˆã‚ã›ã¦åˆ©ç”¨ã—ã¦ãã ã•ã„ã€‚</li>
                                    <li><code>section</code> ã¯å¿…é ˆã€‚æŒ‡å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿ã‚’è¿”ã—ã¾ã™ã€‚</li>
                                </ul>
                            </div>
                        </section>
        </div>

        <footer class="text-center text-slate-500 mt-12 py-4">
            &copy; 2024 API Design by Gemini. All Rights Reserved.
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
        (function () {
            const blocks = document.querySelectorAll('pre code');
            blocks.forEach(code => {
                const pre = code.parentElement;
                if (!pre.classList.contains('code-block-wrapper')) pre.classList.add('code-block-wrapper');
                if (pre.querySelector('.copy-btn')) return;
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'copy-btn';
                btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><span>Copy</span>';
                btn.addEventListener('click', async () => {
                    const raw = code.innerText.replace(/\n+$/, '');
                    try {
                        await navigator.clipboard.writeText(raw);
                        btn.classList.add('copied');
                        const original = btn.innerHTML;
                        btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg><span>Copied!</span>';
                        setTimeout(() => { btn.classList.remove('copied'); btn.innerHTML = original; }, 1800);
                    } catch (e) {
                        try {
                            const textarea = document.createElement('textarea');
                            textarea.value = raw;
                            document.body.appendChild(textarea);
                            textarea.select();
                            document.execCommand('copy');
                            document.body.removeChild(textarea);

                            btn.classList.add('copied');
                            const original = btn.innerHTML;
                            btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg><span>Copied!</span>';
                            setTimeout(() => { btn.classList.remove('copied'); btn.innerHTML = original; }, 1800);
                        } catch (err) {
                            btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg><span style="color:#fee2e2">Failed</span>';
                            setTimeout(() => { btn.innerHTML = '<span>Copy</span>'; }, 2000);
                        }
                    }
                });
                pre.appendChild(btn);
            });
        })();
    </script>
</body>

</html>